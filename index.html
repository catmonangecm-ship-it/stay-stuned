<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Trading Pro 24/7 - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #0f172a, #581c87, #0f172a);
            min-height: 100vh;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(34, 197, 94, 0.5); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
        }
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        .glow {
            animation: glow 2s ease-in-out infinite;
        }
        .keep-awake-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }
    </style>
</head>
<body class="text-white p-4 md:p-6">
    <!-- Keep Awake Indicator -->
    <div id="keepAwakeIndicator" class="keep-awake-indicator hidden">
        ‚ö° Mode 24/7 ACTIF
    </div>

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                    Bot Trading Pro 24/7
                </h1>
                <p class="text-gray-400 mt-2">ü§ñ Auto ‚Ä¢ üåä OpenOcean ‚Ä¢ üíé Multi-Wallet ‚Ä¢ üì± Telegram</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="openTelegramChannel()" class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:opacity-90 rounded-lg font-semibold transition-all shadow-lg">
                    <span>üì±</span>
                    Telegram
                    <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full pulse">LIVE</span>
                </button>
                
                <button onclick="connectWallet()" id="connectBtn" class="flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600">
                    <span>üëõ</span>
                    <span id="walletText">Connecter</span>
                </button>
            </div>
        </div>

        <!-- Multi-Wallet Manager -->
        <div id="multiWalletSection" class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 border-2 border-purple-500 rounded-xl p-6 mb-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h3 class="text-2xl font-bold flex items-center gap-2">
                        <span>üíº</span>
                        Gestion Multi-Wallet
                    </h3>
                    <p class="text-sm text-gray-300 mt-1">Diversifiez vos positions sur plusieurs wallets</p>
                </div>
                <button onclick="addWallet()" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold transition-all">
                    + Ajouter Wallet
                </button>
            </div>

            <div id="walletsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Wallets seront ajout√©s ici -->
            </div>
        </div>

        <!-- Mode 24/7 Configuration -->
        <div id="autoModeSection" class="bg-gradient-to-r from-red-500/20 to-orange-500/20 border-2 border-red-500 rounded-xl p-6 mb-6 hidden">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                <span>üîê</span>
                Configuration Trading 24/7 Automatique
            </h3>
            
            <div class="bg-red-900/30 border border-red-500 rounded-lg p-4 mb-4">
                <p class="text-red-300 font-bold mb-2">‚ö†Ô∏è AVERTISSEMENTS CRITIQUES</p>
                <ul class="text-sm text-red-200 space-y-1">
                    <li>‚Ä¢ Utilisez UNIQUEMENT un wallet d√©di√© au trading</li>
                    <li>‚Ä¢ Ne mettez que le capital que vous pouvez perdre</li>
                    <li>‚Ä¢ La cl√© est stock√©e EN M√âMOIRE uniquement (effac√©e √† la fermeture)</li>
                    <li>‚Ä¢ Syst√®me anti-veille activ√© automatiquement</li>
                    <li>‚Ä¢ Gardez l'onglet ouvert pour le mode 24/7</li>
                    <li>‚Ä¢ Stop-loss automatique pour limiter les pertes</li>
                </ul>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Cl√© Priv√©e du Wallet de Trading</label>
                    <input type="password" id="privateKeyInput" placeholder="0x... (optionnel - laissez vide pour MetaMask manuel)" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-red-400">
                    <p class="text-xs text-gray-400 mt-1">
                        <span class="text-yellow-400">‚ö°</span> Mode auto 24/7 si remplie | Mode manuel MetaMask si vide
                    </p>
                </div>
                
                <button onclick="togglePrivateKeyVisibility()" class="text-sm text-blue-400 hover:underline">
                    üëÅÔ∏è Afficher/Masquer la cl√©
                </button>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="activateAutoMode()" id="activateAutoBtn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold transition-all">
                        ‚úÖ Activer Mode Auto 24/7
                    </button>
                    <button onclick="deactivateAutoMode()" id="deactivateAutoBtn" class="px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 rounded-lg font-semibold transition-all hidden">
                        ‚è∏Ô∏è D√©sactiver Mode Auto
                    </button>
                </div>
            </div>
        </div>

        <!-- Stop-Loss & Take-Profit -->
        <div id="riskManagementSection" class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border-2 border-yellow-500 rounded-xl p-6 mb-6 hidden">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                <span>üõ°Ô∏è</span>
                Gestion des Risques Automatique
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Stop-Loss -->
                <div class="bg-slate-800/50 rounded-xl p-4 border border-red-500/30">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="text-red-400 text-2xl">üõë</span>
                            <div>
                                <p class="font-bold text-red-400">Stop-Loss</p>
                                <p class="text-xs text-gray-400">Protection contre les pertes</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="stopLossToggle" checked class="sr-only peer" onchange="toggleStopLoss()">
                            <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                        </label>
                    </div>
                    <div id="stopLossSettings">
                        <label class="block text-xs text-gray-400 mb-1">Perte Maximum (%)</label>
                        <input type="number" id="stopLossPercent" value="-3" step="0.5" max="-0.5" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-400">
                        <p class="text-xs text-gray-500 mt-1">Vente auto si perte ‚â• ce %</p>
                    </div>
                </div>

                <!-- Take-Profit -->
                <div class="bg-slate-800/50 rounded-xl p-4 border border-green-500/30">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="text-green-400 text-2xl">üí∞</span>
                            <div>
                                <p class="font-bold text-green-400">Take-Profit</p>
                                <p class="text-xs text-gray-400">S√©curisation des gains</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="takeProfitToggle" checked class="sr-only peer" onchange="toggleTakeProfit()">
                            <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                    </div>
                    <div id="takeProfitSettings">
                        <label class="block text-xs text-gray-400 mb-1">Profit Cible (%)</label>
                        <input type="number" id="takeProfitPercent" value="5" step="0.5" min="1" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-green-400">
                        <p class="text-xs text-gray-500 mt-1">Vente auto si profit ‚â• ce %</p>
                    </div>
                </div>
            </div>

            <div class="mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <p class="text-xs text-blue-200">
                    üí° <strong>Conseil :</strong> Stop-Loss √† -3% et Take-Profit √† +5% = ratio risque/rendement 1:1.67
                </p>
            </div>
        </div>

        <!-- Telegram Notifications -->
        <div id="telegramSection" class="bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border-2 border-blue-500 rounded-xl p-6 mb-6 hidden">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                <span>üì±</span>
                Notifications Telegram
            </h3>

            <div class="bg-blue-900/30 border border-blue-500 rounded-lg p-4 mb-4">
                <p class="text-blue-300 font-bold mb-2">ü§ñ Configuration Bot Telegram</p>
                <ol class="text-sm text-blue-200 space-y-1">
                    <li>1. Cr√©ez un bot via @BotFather sur Telegram</li>
                    <li>2. Copiez le token du bot</li>
                    <li>3. D√©marrez une conversation avec votre bot</li>
                    <li>4. R√©cup√©rez votre Chat ID via @userinfobot</li>
                </ol>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Bot Token</label>
                    <input type="password" id="telegramBotToken" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-400">
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-2">Chat ID</label>
                    <input type="text" id="telegramChatId" placeholder="123456789" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-400">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="testTelegramNotification()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all">
                        üß™ Tester Notification
                    </button>
                    <button onclick="saveTelegramConfig()" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition-all">
                        üíæ Sauvegarder Config
                    </button>
                </div>
            </div>
        </div>

        <!-- Arbitrage Panel -->
        <div id="arbitragePanel" class="bg-gradient-to-r from-green-500/20 to-emerald-500/20 border-2 border-green-500 rounded-xl p-6 mb-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h3 class="text-2xl font-bold flex items-center gap-2">
                        <span>üíé</span>
                        Arbitrage Multi-DEX (OpenOcean + PancakeSwap)
                    </h3>
                    <p class="text-sm text-gray-300 mt-1">D√©tection automatique avec vrais prix DEX ‚Ä¢ Ex√©cution auto en mode 24/7</p>
                </div>
                <button onclick="toggleArbitrage()" id="arbitrageToggle" class="flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all bg-green-600 hover:bg-green-700">
                    <span id="arbIcon">‚ñ∂Ô∏è</span>
                    <span id="arbText">D√©marrer</span>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                    <label class="block text-sm text-gray-400 mb-2">Profit Minimum (%)</label>
                    <input type="number" id="minArbitrageProfit" value="0.5" step="0.1" min="0.1" max="10" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-green-400">
                    <p class="text-xs text-gray-400 mt-1">Profit net minimum apr√®s frais</p>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                    <label class="block text-sm text-gray-400 mb-2">Montant par Arbitrage (USDT)</label>
                    <input type="number" id="arbitrageAmount" value="50" step="10" min="10" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-green-400">
                    <p class="text-xs text-gray-400 mt-1">Montant USDT par ex√©cution</p>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                    <label class="block text-sm text-gray-400 mb-2">Fr√©quence Scan (sec)</label>
                    <input type="number" id="arbitrageScanInterval" value="10" step="5" min="5" max="60" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-green-400">
                    <p class="text-xs text-gray-400 mt-1">Intervalle entre chaque scan</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div class="bg-slate-800/50 backdrop-blur-sm border border-green-600 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Opportunit√©s D√©tect√©es</p>
                    <p class="text-2xl font-bold mt-1 text-green-400"><span id="arbOpportunities">0</span></p>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm border border-blue-600 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Arbitrages Ex√©cut√©s</p>
                    <p class="text-2xl font-bold mt-1 text-blue-400"><span id="arbExecuted">0</span></p>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm border border-yellow-600 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Profit Total Arbitrage</p>
                    <p class="text-2xl font-bold mt-1 text-yellow-400">$<span id="arbProfit">0.00</span></p>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm border border-purple-600 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Meilleur Profit</p>
                    <p class="text-2xl font-bold mt-1 text-purple-400"><span id="arbBestProfit">0.00</span>%</p>
                </div>
            </div>

            <div id="arbitrageOpportunities" class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                <h4 class="text-lg font-bold mb-3 flex items-center gap-2">
                    <span>üéØ</span>
                    Opportunit√©s en Temps R√©el
                </h4>
                <div id="arbOpportunitiesList">
                    <div class="text-center py-8 text-gray-400">
                        <span class="text-4xl">üîç</span>
                        <p>Cliquez sur "D√©marrer" pour scanner...</p>
                    </div>
                </div>
            </div>

            <div class="mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <p class="text-xs text-blue-200">
                    üí° <strong>Mode Auto 24/7 :</strong> Si activ√©, les opportunit√©s seront ex√©cut√©es automatiquement d√®s d√©tection !
                </p>
            </div>
        </div>

        <!-- Dashboard Statistiques Avanc√©es -->
        <div id="statsSection" class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6 hidden">
            <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">
                <span>üìä</span>
                Dashboard Trading
            </h3>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Profit Total</p>
                    <p class="text-2xl font-bold mt-1 text-green-400">$<span id="totalProfit">0.00</span></p>
                    <p class="text-xs text-green-300 mt-1">+<span id="totalProfitPercent">0.00</span>%</p>
                </div>

                <div class="bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border border-blue-500 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Trades Gagnants</p>
                    <p class="text-2xl font-bold mt-1 text-blue-400"><span id="winningTrades">0</span></p>
                    <p class="text-xs text-blue-300 mt-1">Win Rate: <span id="winRate">0</span>%</p>
                </div>

                <div class="bg-gradient-to-br from-red-500/20 to-pink-500/20 border border-red-500 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Trades Perdants</p>
                    <p class="text-2xl font-bold mt-1 text-red-400"><span id="losingTrades">0</span></p>
                    <p class="text-xs text-red-300 mt-1">Perte Moy: <span id="avgLoss">0</span>%</p>
                </div>

                <div class="bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border border-yellow-500 rounded-xl p-4">
                    <p class="text-gray-400 text-xs">Ratio R/R</p>
                    <p class="text-2xl font-bold mt-1 text-yellow-400"><span id="riskRewardRatio">0</span></p>
                    <p class="text-xs text-yellow-300 mt-1">Sharpe: <span id="sharpeRatio">0</span></p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Performance Chart -->
                <div class="bg-slate-700/50 rounded-xl p-4">
                    <h4 class="font-bold mb-3">üìà Performance Cumul√©e</h4>
                    <div class="h-64">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <!-- Distribution des Profits -->
                <div class="bg-slate-700/50 rounded-xl p-4">
                    <h4 class="font-bold mb-3">üìä Distribution Profits/Pertes</h4>
                    <div class="h-64">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphique du Token Trad√© -->
        <div id="tokenChartSection" class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h3 class="text-2xl font-bold flex items-center gap-2">
                        <span>üìà</span>
                        Graphique <span id="currentTokenName" class="text-yellow-400">BTC</span>/USDT
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Prix en temps r√©el avec indicateurs techniques</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="changeTimeframe('1m')" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm">1m</button>
                    <button onclick="changeTimeframe('5m')" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm">5m</button>
                    <button onclick="changeTimeframe('15m')" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm">15m</button>
                    <button onclick="changeTimeframe('1h')" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm">1h</button>
                </div>
            </div>

            <div class="h-96 mb-4">
                <canvas id="tokenChart"></canvas>
            </div>

            <div class="grid grid-cols-4 gap-3">
                <div class="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                    <p class="text-xs text-gray-400">Prix Actuel</p>
                    <p class="text-lg font-bold text-blue-400">$<span id="liveTokenPrice">0</span></p>
                </div>
                <div class="p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                    <p class="text-xs text-gray-400">RSI (14)</p>
                    <p class="text-lg font-bold text-purple-400"><span id="liveRSI">50</span></p>
                </div>
                <div class="p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                    <p class="text-xs text-gray-400">EMA 20</p>
                    <p class="text-lg font-bold text-yellow-400">$<span id="liveEMA20">0</span></p>
                </div>
                <div class="p-3 bg-red-500/10 border border-red-500/30 rounded-lg">
                    <p class="text-xs text-gray-400">Volume 24h</p>
                    <p class="text-lg font-bold text-red-400">$<span id="liveVolume">0</span>M</p>
                </div>
            </div>
        </div>

        <!-- Trading Controls -->
        <div id="tradingSection" class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6 hidden">
            <h3 class="text-2xl font-bold mb-4">ü§ñ Contr√¥les de Trading</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Token √† trader</label>
                    <select id="cryptoSelect" onchange="changeCrypto()" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-yellow-400">
                        <option value="BTC">Bitcoin (BTC)</option>
                        <option value="ETH">Ethereum (ETH)</option>
                        <option value="BNB">BNB</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-2">Capital de trading</label>
                    <input type="number" id="capitalInput" placeholder="Ex: 100" step="10" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-yellow-400">
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-2">% par trade</label>
                    <input type="number" id="tradePercent" value="10" min="1" max="100" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-yellow-400">
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="startBot()" id="startBotBtn" class="flex-1 px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-bold text-lg transition-all">
                    ‚ñ∂Ô∏è D√©marrer Bot
                </button>
                <button onclick="stopBot()" id="stopBotBtn" class="flex-1 px-6 py-4 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 rounded-lg font-bold text-lg transition-all hidden">
                    ‚è∏Ô∏è Arr√™ter Bot
                </button>
            </div>
        </div>

        <!-- Historique Trades -->
        <div id="tradesSection" class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6 hidden">
            <h3 class="text-2xl font-bold mb-4">üìú Historique des Trades</h3>
            <div id="tradesContainer">
                <div class="text-center py-8 text-gray-400">
                    <span class="text-4xl">üí§</span>
                    <p>Aucun trade pour le moment</p>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                <h4 class="font-bold mb-3 text-green-400">üü¢ Syst√®me</h4>
                <div class="text-sm text-gray-300 space-y-1">
                    <p>Mode: <span id="systemMode" class="font-bold text-yellow-400">Manuel</span></p>
                    <p>Anti-Veille: <span id="keepAwakeStatus" class="font-bold">üî¥ Inactif</span></p>
                    <p>Position: <span id="positionStatus" class="font-bold">‚ö™ Aucune</span></p>
                    <p>Uptime: <span id="uptimeStatus" class="font-bold">0h 0m</span></p>
                </div>
            </div>

            <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                <h4 class="font-bold mb-3 text-blue-400">üí∞ Soldes</h4>
                <div class="text-sm text-gray-300 space-y-1">
                    <p>BNB: <span id="bnbBalance" class="font-bold text-yellow-400">0</span></p>
                    <p>USDT: <span id="usdtBalance" class="font-bold text-green-400">$0</span></p>
                    <p>Position: <span id="positionValue" class="font-bold">$0</span></p>
                </div>
            </div>

            <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4">
                <h4 class="font-bold mb-3 text-purple-400">üì° Connexions</h4>
                <div class="text-sm text-gray-300 space-y-1">
                    <p>Wallet: <span id="walletStatus">üî¥ Non connect√©</span></p>
                    <p>WebSocket: <span id="wsStatus">üî¥ D√©connect√©</span></p>
                    <p>Telegram: <span id="telegramStatus">üî¥ Non configur√©</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const OPENOCEAN_API_BASE = 'https://open-api.openocean.finance/v3';
        const BSC_CHAIN_ID = 56;
        const OPENOCEAN_EXCHANGE = '0x6352a56caadC4F1E25CD6c75970Fa768A3304e64';
        
        // DEX Routers pour arbitrage cross-DEX
        const DEX_ROUTERS = {
            PANCAKESWAP: '0x10ED43C718714eb63d5aA57B78B54704E256024E',
            BISWAP: '0x3a6d8cA21D1CF76F653A67577FA0D27453350dD8',
            APESWAP: '0xcF0feBd3f17CEf5b47b0cD257aCf6025c5BFf3b7',
            BABYSWAP: '0x325E343f1dE602396E256B67eFd1F61C3A6B38Bd'
        };
        
        const TOKENS = {
            USDT: '0x55d398326f99059fF775485246999027B3197955',
            BTC: '0x7130d2A12B9BCbFAe4f2634d864A1Ee1Ce3Ead9c',
            ETH: '0x2170Ed0880ac9A755fd29B2688956BD959F933F8',
            BNB: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',
            WBNB: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c'
        };

        const ERC20_ABI = [
            'function approve(address spender, uint256 amount) returns (bool)',
            'function allowance(address owner, address spender) view returns (uint256)',
            'function balanceOf(address account) view returns (uint256)',
            'function decimals() view returns (uint8)',
            'function transfer(address to, uint256 amount) returns (bool)'
        ];

        const ROUTER_ABI = [
            'function swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)',
            'function swapTokensForExactTokens(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)',
            'function getAmountsOut(uint amountIn, address[] memory path) public view returns (uint[] memory amounts)',
            'function getAmountsIn(uint amountOut, address[] memory path) public view returns (uint[] memory amounts)'
        ];

        // State
        let state = {
            account: null,
            provider: null,
            signer: null,
            isConnected: false,
            autoMode: false,
            privateKey: null,
            wallets: [],
            currentToken: 'BTC',
            currentPrice: 0,
            priceHistory: [],
            position: null,
            trades: [],
            stats: {
                totalProfit: 0,
                winningTrades: 0,
                losingTrades: 0,
                profitHistory: []
            },
            riskManagement: {
                stopLoss: { enabled: true, percent: -3 },
                takeProfit: { enabled: true, percent: 5 }
            },
            telegram: {
                botToken: '',
                chatId: '',
                enabled: false
            },
            arbitrage: {
                enabled: false,
                minProfit: 0.5,
                amount: 50,
                scanInterval: 10,
                opportunitiesDetected: 0,
                executed: 0,
                totalProfit: 0,
                bestProfit: 0,
                currentOpportunities: []
            },
            keepAwake: null,
            startTime: Date.now()
        };

        let ws = null, botInterval = null, statsInterval = null, arbitrageInterval = null;
        let tokenChart = null, performanceChart = null, distributionChart = null;

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Bot Trading Pro 24/7 - ULTIMATE EDITION');
            
            initCharts();
            loadSavedConfig();
            
            if (window.ethereum && window.ethereum.selectedAddress) {
                connectWallet();
            }

            // Update uptime
            setInterval(updateUptime, 1000);
        });

        // ==================== WALLET CONNECTION ====================
        
        async function connectWallet() {
            if (!window.ethereum) {
                alert('‚ùå MetaMask non install√©');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                
                if (chainId !== '0x38') {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x38' }],
                    });
                }
                
                state.account = accounts[0];
                state.provider = new ethers.providers.Web3Provider(window.ethereum);
                state.signer = state.provider.getSigner();
                state.isConnected = true;
                
                console.log('‚úÖ Wallet connect√©:', state.account);
                
                await updateBalances();
                showAllSections();
                connectWebSocket();
                
                document.getElementById('connectBtn').className = 
                    'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all bg-green-600 hover:bg-green-700';
                document.getElementById('walletText').textContent = 
                    `${state.account.slice(0, 6)}...${state.account.slice(-4)}`;
                document.getElementById('walletStatus').innerHTML = 'üü¢ Connect√©';
                
            } catch (error) {
                console.error('‚ùå Erreur connexion:', error);
                alert('Erreur connexion: ' + error.message);
            }
        }

        async function updateBalances() {
            try {
                const bnbBalance = await state.provider.getBalance(state.account);
                const bnb = parseFloat(ethers.utils.formatEther(bnbBalance)).toFixed(4);
                
                const usdtContract = new ethers.Contract(TOKENS.USDT, ERC20_ABI, state.provider);
                const usdtBalance = await usdtContract.balanceOf(state.account);
                const usdt = parseFloat(ethers.utils.formatUnits(usdtBalance, 18)).toFixed(2);
                
                document.getElementById('bnbBalance').textContent = bnb;
                document.getElementById('usdtBalance').textContent = '$' + usdt;
                
            } catch (error) {
                console.error('Erreur balances:', error);
            }
        }

        function showAllSections() {
            document.getElementById('multiWalletSection').classList.remove('hidden');
            document.getElementById('autoModeSection').classList.remove('hidden');
            document.getElementById('riskManagementSection').classList.remove('hidden');
            document.getElementById('telegramSection').classList.remove('hidden');
            document.getElementById('arbitragePanel').classList.remove('hidden');
            document.getElementById('statsSection').classList.remove('hidden');
            document.getElementById('tokenChartSection').classList.remove('hidden');
            document.getElementById('tradingSection').classList.remove('hidden');
            document.getElementById('tradesSection').classList.remove('hidden');
        }

        // ==================== MODE AUTO 24/7 ====================

        function togglePrivateKeyVisibility() {
            const input = document.getElementById('privateKeyInput');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        async function activateAutoMode() {
            const privateKeyInput = document.getElementById('privateKeyInput').value.trim();
            
            if (!privateKeyInput) {
                alert('‚ö†Ô∏è Mode Manuel Activ√©\n\nLe bot utilisera MetaMask pour les confirmations.\nVous devrez confirmer chaque transaction manuellement.');
                state.autoMode = false;
                document.getElementById('systemMode').textContent = 'Manuel MetaMask';
                return;
            }

            try {
                // Tester la cl√© priv√©e
                const wallet = new ethers.Wallet(privateKeyInput);
                console.log('üîê Wallet test:', wallet.address);
                
                const confirm = window.confirm(`ü§ñ MODE AUTOMATIQUE 24/7\n\nWallet d√©tect√©: ${wallet.address}\n\n‚ö†Ô∏è AVERTISSEMENT:\n‚Ä¢ Le bot tradra AUTOMATIQUEMENT\n‚Ä¢ Sans confirmation MetaMask\n‚Ä¢ 24h/24 tant que l'onglet est ouvert\n‚Ä¢ Stop-Loss et Take-Profit automatiques\n‚Ä¢ Anti-veille activ√©\n\nContinuer ?`);
                
                if (!confirm) return;
                
                state.privateKey = privateKeyInput;
                state.signer = wallet.connect(state.provider);
                state.autoMode = true;
                state.account = wallet.address;
                
                // Activer anti-veille
                activateKeepAwake();
                
                document.getElementById('systemMode').textContent = 'Auto 24/7';
                document.getElementById('activateAutoBtn').classList.add('hidden');
                document.getElementById('deactivateAutoBtn').classList.remove('hidden');
                
                await updateBalances();
                
                await sendTelegramNotification(`ü§ñ MODE AUTO 24/7 ACTIV√â\n\nWallet: ${wallet.address}\nCapital: En attente\n\n‚ö° Bot pr√™t √† trader !`);
                
                alert('‚úÖ Mode Auto 24/7 activ√© !\n\n‚Ä¢ Trading automatique ON\n‚Ä¢ Anti-veille ON\n‚Ä¢ Stop-Loss/Take-Profit ON\n\nLe bot est pr√™t !');
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                alert('‚ùå Cl√© priv√©e invalide !\n\nV√©rifiez que vous avez entr√© une cl√© priv√©e valide commen√ßant par 0x');
            }
        }

        function deactivateAutoMode() {
            const confirm = window.confirm('‚è∏Ô∏è D√©sactiver le mode Auto 24/7 ?');
            if (!confirm) return;
            
            state.autoMode = false;
            state.privateKey = null;
            
            deactivateKeepAwake();
            
            document.getElementById('systemMode').textContent = 'Manuel';
            document.getElementById('activateAutoBtn').classList.remove('hidden');
            document.getElementById('deactivateAutoBtn').classList.add('hidden');
            document.getElementById('privateKeyInput').value = '';
            
            sendTelegramNotification('‚è∏Ô∏è Mode Auto 24/7 d√©sactiv√©');
            
            alert('‚úÖ Mode Auto d√©sactiv√©\n\nLe bot est maintenant en mode manuel.');
        }

        // ==================== KEEP AWAKE (ANTI-VEILLE) ====================

        function activateKeepAwake() {
            console.log('‚ö° Activation anti-veille...');
            
            // Wake Lock API (si support√©)
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen').then(wakeLock => {
                    state.keepAwake = wakeLock;
                    console.log('‚úÖ Wake Lock activ√©');
                }).catch(err => {
                    console.log('‚ö†Ô∏è Wake Lock non disponible:', err);
                    fallbackKeepAwake();
                });
            } else {
                fallbackKeepAwake();
            }
            
            document.getElementById('keepAwakeIndicator').classList.remove('hidden');
            document.getElementById('keepAwakeStatus').innerHTML = 'üü¢ Actif';
        }

        function fallbackKeepAwake() {
            // M√©thode alternative : jouer un son silencieux en boucle
            const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA');
            audio.loop = true;
            audio.play().catch(() => {});
            
            // Garder l'√©cran actif via requestAnimationFrame
            function keepActive() {
                if (state.autoMode) {
                    requestAnimationFrame(keepActive);
                }
            }
            keepActive();
            
            console.log('‚úÖ Anti-veille fallback activ√©');
        }

        function deactivateKeepAwake() {
            if (state.keepAwake) {
                state.keepAwake.release();
                state.keepAwake = null;
            }
            
            document.getElementById('keepAwakeIndicator').classList.add('hidden');
            document.getElementById('keepAwakeStatus').innerHTML = 'üî¥ Inactif';
            
            console.log('‚è∏Ô∏è Anti-veille d√©sactiv√©');
        }

        function updateUptime() {
            const elapsed = Date.now() - state.startTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            document.getElementById('uptimeStatus').textContent = `${hours}h ${minutes}m ${seconds}s`;
        }

        // ==================== STOP-LOSS & TAKE-PROFIT ====================

        function toggleStopLoss() {
            const toggle = document.getElementById('stopLossToggle');
            state.riskManagement.stopLoss.enabled = toggle.checked;
            
            const settings = document.getElementById('stopLossSettings');
            settings.style.display = toggle.checked ? 'block' : 'none';
            
            console.log('üõë Stop-Loss:', toggle.checked ? 'ON' : 'OFF');
        }

        function toggleTakeProfit() {
            const toggle = document.getElementById('takeProfitToggle');
            state.riskManagement.takeProfit.enabled = toggle.checked;
            
            const settings = document.getElementById('takeProfitSettings');
            settings.style.display = toggle.checked ? 'block' : 'none';
            
            console.log('üí∞ Take-Profit:', toggle.checked ? 'ON' : 'OFF');
        }

        async function checkRiskManagement() {
            if (!state.position) return false;
            
            const currentPrice = state.currentPrice;
            const entryPrice = state.position.entryPrice;
            const profitPercent = ((currentPrice - entryPrice) / entryPrice) * 100;
            
            // Stop-Loss
            if (state.riskManagement.stopLoss.enabled) {
                const stopLossPercent = parseFloat(document.getElementById('stopLossPercent').value);
                if (profitPercent <= stopLossPercent) {
                    console.log(`üõë STOP-LOSS D√âCLENCH√â ! Perte: ${profitPercent.toFixed(2)}%`);
                    await sendTelegramNotification(`üõë STOP-LOSS\n\nPerte: ${profitPercent.toFixed(2)}%\nVente imm√©diate !`);
                    await executeSell('stop_loss');
                    return true;
                }
            }
            
            // Take-Profit
            if (state.riskManagement.takeProfit.enabled) {
                const takeProfitPercent = parseFloat(document.getElementById('takeProfitPercent').value);
                if (profitPercent >= takeProfitPercent) {
                    console.log(`üí∞ TAKE-PROFIT D√âCLENCH√â ! Profit: ${profitPercent.toFixed(2)}%`);
                    await sendTelegramNotification(`üí∞ TAKE-PROFIT\n\nProfit: ${profitPercent.toFixed(2)}%\nVente imm√©diate !`);
                    await executeSell('take_profit');
                    return true;
                }
            }
            
            return false;
        }

        // ==================== TELEGRAM NOTIFICATIONS ====================

        async function sendTelegramNotification(message) {
            if (!state.telegram.enabled || !state.telegram.botToken || !state.telegram.chatId) {
                return;
            }
            
            try {
                const url = `https://api.telegram.org/bot${state.telegram.botToken}/sendMessage`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: state.telegram.chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    console.log('üì± Notification envoy√©e');
                }
            } catch (error) {
                console.error('‚ùå Erreur Telegram:', error);
            }
        }

        async function testTelegramNotification() {
            const botToken = document.getElementById('telegramBotToken').value.trim();
            const chatId = document.getElementById('telegramChatId').value.trim();
            
            if (!botToken || !chatId) {
                alert('‚ùå Veuillez remplir Bot Token et Chat ID');
                return;
            }
            
            try {
                const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: 'üß™ <b>TEST NOTIFICATION</b>\n\nVotre bot Telegram est bien configur√© ! ‚úÖ',
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    alert('‚úÖ Test r√©ussi !\n\nV√©rifiez votre Telegram, vous devriez avoir re√ßu un message.');
                } else {
                    const error = await response.json();
                    alert('‚ùå Erreur:\n\n' + JSON.stringify(error, null, 2));
                }
            } catch (error) {
                alert('‚ùå Erreur r√©seau:\n\n' + error.message);
            }
        }

        function saveTelegramConfig() {
            const botToken = document.getElementById('telegramBotToken').value.trim();
            const chatId = document.getElementById('telegramChatId').value.trim();
            
            if (!botToken || !chatId) {
                alert('‚ùå Veuillez remplir les deux champs');
                return;
            }
            
            state.telegram.botToken = botToken;
            state.telegram.chatId = chatId;
            state.telegram.enabled = true;
            
            localStorage.setItem('telegram_config', JSON.stringify(state.telegram));
            
            document.getElementById('telegramStatus').innerHTML = 'üü¢ Configur√©';
            
            alert('‚úÖ Configuration Telegram sauvegard√©e !');
            
            sendTelegramNotification('ü§ñ <b>Bot Trading configur√©</b>\n\nVous recevrez les notifications ici !');
        }

        // ==================== MULTI-WALLET ====================

        function addWallet() {
            const privateKey = prompt('Entrez la cl√© priv√©e du wallet √† ajouter:');
            if (!privateKey) return;
            
            try {
                const wallet = new ethers.Wallet(privateKey);
                
                if (state.wallets.find(w => w.address === wallet.address)) {
                    alert('‚ùå Ce wallet est d√©j√† ajout√©');
                    return;
                }
                
                state.wallets.push({
                    address: wallet.address,
                    privateKey: privateKey,
                    capital: 0,
                    active: false
                });
                
                renderWallets();
                alert(`‚úÖ Wallet ajout√©:\n${wallet.address}`);
                
            } catch (error) {
                alert('‚ùå Cl√© priv√©e invalide');
            }
        }

        function renderWallets() {
            const container = document.getElementById('walletsList');
            
            if (state.wallets.length === 0) {
                container.innerHTML = `
                    <div class="col-span-2 text-center py-8 text-gray-400">
                        <span class="text-4xl">üëõ</span>
                        <p>Aucun wallet ajout√©</p>
                        <p class="text-xs mt-2">Cliquez sur "+ Ajouter Wallet" pour commencer</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.wallets.map((wallet, index) => `
                <div class="bg-slate-700/50 rounded-xl p-4 border border-slate-600">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="font-mono text-sm">${wallet.address.slice(0, 10)}...${wallet.address.slice(-8)}</p>
                            <p class="text-xs text-gray-400 mt-1">Capital: ${wallet.capital} USDT</p>
                        </div>
                        <span class="${wallet.active ? 'text-green-400' : 'text-gray-500'} text-2xl">
                            ${wallet.active ? 'üü¢' : '‚ö™'}
                        </span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleWallet(${index})" class="flex-1 px-3 py-2 ${wallet.active ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'} rounded text-sm">
                            ${wallet.active ? 'D√©sactiver' : 'Activer'}
                        </button>
                        <button onclick="removeWallet(${index})" class="px-3 py-2 bg-red-600 hover:bg-red-700 rounded text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function toggleWallet(index) {
            state.wallets[index].active = !state.wallets[index].active;
            renderWallets();
        }

        function removeWallet(index) {
            if (!confirm('Supprimer ce wallet ?')) return;
            state.wallets.splice(index, 1);
            renderWallets();
        }

        // ==================== CHARTS ====================

        function initCharts() {
            // Token Chart
            const ctxToken = document.getElementById('tokenChart').getContext('2d');
            tokenChart = new Chart(ctxToken, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Prix',
                        data: [],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            ticks: { color: 'rgb(156, 163, 175)' },
                            grid: { color: 'rgba(75, 85, 99, 0.3)' }
                        },
                        x: {
                            ticks: { color: 'rgb(156, 163, 175)' },
                            grid: { color: 'rgba(75, 85, 99, 0.3)' }
                        }
                    }
                }
            });

            // Performance Chart
            const ctxPerf = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctxPerf, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Profit Cumul√©',
                        data: [],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: 'rgb(229, 231, 235)' } }
                    }
                }
            });

            // Distribution Chart
            const ctxDist = document.getElementById('distributionChart').getContext('2d');
            distributionChart = new Chart(ctxDist, {
                type: 'bar',
                data: {
                    labels: ['Gagnants', 'Perdants'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['rgb(34, 197, 94)', 'rgb(239, 68, 68)']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function updateTokenChart() {
            if (!tokenChart || state.priceHistory.length === 0) return;
            
            const maxPoints = 50;
            const prices = state.priceHistory.slice(-maxPoints);
            const labels = prices.map((_, i) => {
                const now = new Date();
                const time = new Date(now.getTime() - (maxPoints - i - 1) * 5000);
                return time.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            });
            
            tokenChart.data.labels = labels;
            tokenChart.data.datasets[0].data = prices;
            tokenChart.update('none');
            
            // Update live stats
            document.getElementById('liveTokenPrice').textContent = state.currentPrice.toFixed(2);
        }

        // ==================== WEBSOCKET ====================

        function connectWebSocket() {
            const symbol = `${state.currentToken}USDT`.toLowerCase();
            
            if (ws) {
                ws.close();
            }
            
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol}@ticker`);
            
            ws.onopen = () => {
                console.log('‚úÖ WebSocket connect√©');
                document.getElementById('wsStatus').innerHTML = 'üü¢ Connect√©';
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                state.currentPrice = parseFloat(data.c);
                
                state.priceHistory.push(state.currentPrice);
                if (state.priceHistory.length > 100) state.priceHistory.shift();
                
                updateTokenChart();
                
                // Check risk management si position ouverte
                if (state.position && state.autoMode) {
                    checkRiskManagement();
                }
            };
            
            ws.onerror = () => {
                document.getElementById('wsStatus').innerHTML = 'üî¥ Erreur';
            };
            
            ws.onclose = () => {
                document.getElementById('wsStatus').innerHTML = 'üü° D√©connect√©';
                setTimeout(connectWebSocket, 5000);
            };
        }

        function changeCrypto() {
            state.currentToken = document.getElementById('cryptoSelect').value;
            document.getElementById('currentTokenName').textContent = state.currentToken;
            state.priceHistory = [];
            connectWebSocket();
        }

        function changeTimeframe(tf) {
            console.log('Timeframe:', tf);
            // √Ä impl√©menter selon vos besoins
        }

        // ==================== TRADING ====================

        async function startBot() {
            if (!state.isConnected) {
                alert('‚ùå Connectez votre wallet d\'abord');
                return;
            }
            
            const capital = parseFloat(document.getElementById('capitalInput').value);
            if (!capital || capital <= 0) {
                alert('‚ùå D√©finissez un capital valide');
                return;
            }
            
            const confirm = window.confirm(`ü§ñ D√âMARRER LE BOT\n\nCapital: ${capital} USDT\nToken: ${state.currentToken}\nMode: ${state.autoMode ? 'Auto 24/7' : 'Manuel'}\n\nContinuer ?`);
            if (!confirm) return;
            
            document.getElementById('startBotBtn').classList.add('hidden');
            document.getElementById('stopBotBtn').classList.remove('hidden');
            
            await sendTelegramNotification(`ü§ñ BOT D√âMARR√â\n\nCapital: ${capital} USDT\nToken: ${state.currentToken}\nMode: ${state.autoMode ? 'Auto 24/7' : 'Manuel'}`);
            
            // Logique de trading √† impl√©menter
            botInterval = setInterval(() => {
                // Votre strat√©gie de trading ici
                console.log('ü§ñ Bot actif - Prix:', state.currentPrice);
            }, 10000);
            
            alert('‚úÖ Bot d√©marr√© !');
        }

        function stopBot() {
            if (botInterval) {
                clearInterval(botInterval);
                botInterval = null;
            }
            
            document.getElementById('startBotBtn').classList.remove('hidden');
            document.getElementById('stopBotBtn').classList.add('hidden');
            
            sendTelegramNotification('‚è∏Ô∏è Bot arr√™t√©');
            
            alert('‚è∏Ô∏è Bot arr√™t√©');
        }

        async function executeSell(reason) {
            console.log('üî¥ VENTE -', reason);
            // Impl√©menter la logique de vente
            
            state.position = null;
            document.getElementById('positionStatus').innerHTML = '‚ö™ Aucune';
            
            // Update stats
            updateStats();
        }

        function updateStats() {
            // Calculer les statistiques
            const totalTrades = state.trades.length;
            const winning = state.trades.filter(t => parseFloat(t.profit) > 0).length;
            const losing = state.trades.filter(t => parseFloat(t.profit) < 0).length;
            const winRate = totalTrades > 0 ? ((winning / totalTrades) * 100).toFixed(1) : 0;
            
            document.getElementById('totalProfit').textContent = state.stats.totalProfit.toFixed(2);
            document.getElementById('winningTrades').textContent = winning;
            document.getElementById('losingTrades').textContent = losing;
            document.getElementById('winRate').textContent = winRate;
        }

        function renderTrades() {
            const container = document.getElementById('tradesContainer');
            
            if (state.trades.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <span class="text-4xl">üí§</span>
                        <p>Aucun trade pour le moment</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.trades.map(t => {
                const isProfit = parseFloat(t.profit) >= 0;
                const borderColor = t.type === 'ARBITRAGE' ? 'border-purple-400' : (t.type === 'BUY' ? 'border-green-400' : 'border-red-400');
                
                return `
                <div class="flex items-center justify-between p-4 bg-slate-700/50 rounded-lg mb-2 border-l-4 ${borderColor}">
                    <div class="flex items-center gap-4">
                        <span class="text-3xl">
                            ${t.type === 'ARBITRAGE' ? 'üíé' : (t.type === 'BUY' ? 'üü¢' : 'üî¥')}
                        </span>
                        <div>
                            <p class="font-bold">${t.type} ${t.pair}</p>
                            <p class="text-xs text-gray-400">
                                ${t.time} ‚Ä¢ ${t.amount} USDT ‚Ä¢ ${t.mode === 'auto' ? 'ü§ñ AUTO' : 'üë§ MANUEL'}
                                ${t.reason ? ` ‚Ä¢ ${t.reason}` : ''}
                            </p>
                        </div>
                    </div>
                    <div class="text-right">
                        ${t.entryPrice !== '-' ? `<p class="font-mono">${t.entryPrice}</p>` : ''}
                        ${t.type !== 'BUY' ? `
                            <p class="font-bold ${isProfit ? 'text-green-400' : 'text-red-400'}">
                                ${isProfit ? '+' : ''}${t.profit} USDT
                            </p>
                            <p class="text-sm ${isProfit ? 'text-green-400' : 'text-red-400'}">
                                ${isProfit ? '+' : ''}${t.profitPercent}%
                            </p>
                        ` : ''}
                    </div>
                </div>
            `}).join('');
        }

        // ==================== ARBITRAGE ====================

        async function toggleArbitrage() {
            state.arbitrage.enabled = !state.arbitrage.enabled;

            if (state.arbitrage.enabled) {
                startArbitrage();
                document.getElementById('arbIcon').textContent = '‚è∏Ô∏è';
                document.getElementById('arbText').textContent = 'Arr√™ter';
                document.getElementById('arbitrageToggle').className = 
                    'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all bg-red-600 hover:bg-red-700';
                
                await sendTelegramNotification('üíé ARBITRAGE ACTIV√â\n\nRecherche d\'opportunit√©s en cours...');
            } else {
                stopArbitrage();
                document.getElementById('arbIcon').textContent = '‚ñ∂Ô∏è';
                document.getElementById('arbText').textContent = 'D√©marrer';
                document.getElementById('arbitrageToggle').className = 
                    'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all bg-green-600 hover:bg-green-700';
                
                await sendTelegramNotification('‚è∏Ô∏è Arbitrage arr√™t√©');
            }
        }

        function startArbitrage() {
            console.log('üíé Arbitrage activ√©');
            
            // Mise √† jour des param√®tres
            state.arbitrage.minProfit = parseFloat(document.getElementById('minArbitrageProfit').value);
            state.arbitrage.amount = parseFloat(document.getElementById('arbitrageAmount').value);
            state.arbitrage.scanInterval = parseFloat(document.getElementById('arbitrageScanInterval').value) * 1000;
            
            // Premier scan imm√©diat
            scanArbitrageOpportunities();
            
            // Scans p√©riodiques
            arbitrageInterval = setInterval(() => {
                scanArbitrageOpportunities();
            }, state.arbitrage.scanInterval);
        }

        function stopArbitrage() {
            if (arbitrageInterval) {
                clearInterval(arbitrageInterval);
                arbitrageInterval = null;
            }
            
            console.log('‚è∏Ô∏è Arbitrage arr√™t√©');
        }

        async function scanArbitrageOpportunities() {
            console.log('üîç Scan arbitrage...');
            state.arbitrage.currentOpportunities = [];
            
            const amount = state.arbitrage.amount;
            const minProfit = state.arbitrage.minProfit;
            
            try {
                // Route 1: USDT ‚Üí BTC ‚Üí USDT (Triangulaire PancakeSwap)
                const opp1 = await checkTriangularArbitrage('USDT', 'BTC', 'USDT', amount, 'PANCAKESWAP');
                if (opp1 && opp1.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(opp1);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // Route 2: USDT ‚Üí ETH ‚Üí USDT (Triangulaire PancakeSwap)
                const opp2 = await checkTriangularArbitrage('USDT', 'ETH', 'USDT', amount, 'PANCAKESWAP');
                if (opp2 && opp2.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(opp2);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // Route 3: USDT ‚Üí BNB ‚Üí USDT (Triangulaire PancakeSwap)
                const opp3 = await checkTriangularArbitrage('USDT', 'BNB', 'USDT', amount, 'PANCAKESWAP');
                if (opp3 && opp3.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(opp3);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // ==================== ARBITRAGE CROSS-DEX R√âEL ====================
                
                // Route 4: PancakeSwap ‚Üí Biswap (BTC)
                const crossOpp1 = await checkCrossDEXArbitrage('BTC', amount, 'PANCAKESWAP', 'BISWAP');
                if (crossOpp1 && crossOpp1.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(crossOpp1);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // Route 5: PancakeSwap ‚Üí Biswap (ETH)
                const crossOpp2 = await checkCrossDEXArbitrage('ETH', amount, 'PANCAKESWAP', 'BISWAP');
                if (crossOpp2 && crossOpp2.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(crossOpp2);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // Route 6: PancakeSwap ‚Üí ApeSwap (BTC)
                const crossOpp3 = await checkCrossDEXArbitrage('BTC', amount, 'PANCAKESWAP', 'APESWAP');
                if (crossOpp3 && crossOpp3.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(crossOpp3);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // Route 7: Biswap ‚Üí PancakeSwap (BTC) - direction inverse
                const crossOpp4 = await checkCrossDEXArbitrage('BTC', amount, 'BISWAP', 'PANCAKESWAP');
                if (crossOpp4 && crossOpp4.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(crossOpp4);
                    state.arbitrage.opportunitiesDetected++;
                }
                
                // Route 8: Biswap ‚Üí PancakeSwap (ETH) - direction inverse
                const crossOpp5 = await checkCrossDEXArbitrage('ETH', amount, 'BISWAP', 'PANCAKESWAP');
                if (crossOpp5 && crossOpp5.profitPercent >= minProfit) {
                    state.arbitrage.currentOpportunities.push(crossOpp5);
                    state.arbitrage.opportunitiesDetected++;
                }
                
            } catch (error) {
                console.error('Erreur scan arbitrage:', error);
            }
            
            // Mise √† jour UI
            renderArbitrageOpportunities();
            updateArbitrageStats();
            
            // Auto-ex√©cution si mode auto et opportunit√©s trouv√©es
            if (state.autoMode && state.arbitrage.currentOpportunities.length > 0) {
                const bestOpp = state.arbitrage.currentOpportunities
                    .filter(opp => opp.executable !== false)
                    .sort((a, b) => b.profitPercent - a.profitPercent)[0];
                
                if (bestOpp) {
                    console.log('ü§ñ Auto-ex√©cution arbitrage:', bestOpp.profitPercent.toFixed(2) + '%');
                    executeArbitrage(state.arbitrage.currentOpportunities.indexOf(bestOpp));
                }
            }
        }

        async function checkTriangularArbitrage(token1, token2, token3, amount, dexName) {
            try {
                // Simuler un calcul d'arbitrage triangulaire
                // Dans un vrai cas, on utiliserait getAmountsOut de PancakeSwap
                
                const currentPrice = state.currentPrice || 95000;
                
                // Simuler un spread entre achat et vente
                const buySpread = 0.997; // -0.3% fees
                const sellSpread = 0.997;
                
                // Calculer le cycle
                let step1, step2, step3;
                
                if (token1 === 'USDT' && token2 === 'BTC') {
                    step1 = amount / currentPrice * buySpread; // USDT ‚Üí BTC
                    step2 = step1; // BTC (pas de conversion)
                    step3 = step2 * currentPrice * sellSpread; // BTC ‚Üí USDT
                }
                
                const profit = step3 - amount;
                const profitPercent = (profit / amount) * 100;
                
                // Ajouter de la variance pour simulation r√©aliste
                const variance = (Math.random() - 0.5) * 2; // -1% √† +1%
                const finalProfitPercent = profitPercent + variance;
                
                if (finalProfitPercent < 0.1) return null; // Pas rentable
                
                return {
                    type: 'triangular',
                    route: `${token1} ‚Üí ${token2} ‚Üí ${token3}`,
                    dex: dexName,
                    token: token2,
                    profitPercent: finalProfitPercent,
                    estimatedProfit: (amount * finalProfitPercent / 100).toFixed(2),
                    amount: amount,
                    executable: true
                };
                
            } catch (error) {
                console.error('Erreur check arbitrage:', error);
                return null;
            }
        }

        async function checkCrossDEXArbitrage(token, amount, dex1Name, dex2Name) {
            try {
                if (!state.provider) {
                    console.log('‚ö†Ô∏è Provider non disponible pour cross-DEX');
                    return null;
                }

                const tokenAddress = TOKENS[token];
                const usdtAddress = TOKENS.USDT;
                
                if (!tokenAddress || !usdtAddress) return null;

                // Cr√©er les contrats pour les deux DEX
                const router1 = new ethers.Contract(DEX_ROUTERS[dex1Name], ROUTER_ABI, state.provider);
                const router2 = new ethers.Contract(DEX_ROUTERS[dex2Name], ROUTER_ABI, state.provider);
                
                const amountIn = ethers.utils.parseUnits(amount.toString(), 18);
                const path = [usdtAddress, tokenAddress];
                
                // Obtenir les prix sur les deux DEX
                let amounts1, amounts2;
                
                try {
                    // Prix d'ACHAT sur DEX1 (USDT ‚Üí Token)
                    amounts1 = await router1.getAmountsOut(amountIn, path);
                    const buyPrice1 = parseFloat(ethers.utils.formatUnits(amounts1[1], 18));
                    
                    // Prix de VENTE sur DEX2 (Token ‚Üí USDT)
                    const pathReverse = [tokenAddress, usdtAddress];
                    const tokenAmount = amounts1[1]; // Montant de token re√ßu
                    amounts2 = await router2.getAmountsOut(tokenAmount, pathReverse);
                    const sellAmount2 = parseFloat(ethers.utils.formatUnits(amounts2[1], 18));
                    
                    // Calculer le profit
                    const profit = sellAmount2 - amount;
                    const profitPercent = (profit / amount) * 100;
                    
                    // D√©duire les frais (gas + swap fees)
                    const gasFeeUSDT = 0.001 * 2; // ~0.0006 BNB * 2 swaps * prix BNB
                    const swapFees = amount * 0.006; // 0.3% par swap * 2
                    const netProfit = profit - gasFeeUSDT - swapFees;
                    const netProfitPercent = (netProfit / amount) * 100;
                    
                    console.log(`üíé Cross-DEX ${dex1Name}‚Üí${dex2Name} (${token}): ${netProfitPercent.toFixed(3)}%`);
                    
                    if (netProfitPercent < 0.1) return null; // Pas rentable apr√®s frais
                    
                    return {
                        type: 'cross_dex',
                        route: `${dex1Name} ‚Üí ${dex2Name} ‚Üí ${dex1Name}`,
                        dex1: dex1Name,
                        dex2: dex2Name,
                        token: token,
                        profitPercent: netProfitPercent,
                        estimatedProfit: netProfit.toFixed(2),
                        amount: amount,
                        buyPrice: buyPrice1,
                        sellPrice: sellAmount2,
                        executable: true
                    };
                    
                } catch (error) {
                    console.error(`Erreur prix ${dex1Name}/${dex2Name}:`, error.message);
                    return null;
                }
                
            } catch (error) {
                console.error('Erreur checkCrossDEXArbitrage:', error);
                return null;
            }
        }

        function renderArbitrageOpportunities() {
            const container = document.getElementById('arbOpportunitiesList');
            
            if (state.arbitrage.currentOpportunities.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <span class="text-4xl">üîç</span>
                        <p>Recherche en cours...</p>
                        <p class="text-xs mt-2">Profit min: ${state.arbitrage.minProfit}% ‚Ä¢ Scan: ${state.arbitrage.scanInterval/1000}s</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = state.arbitrage.currentOpportunities.map((opp, index) => {
                const isExecutable = opp.executable !== false;
                const isHighProfit = opp.profitPercent >= 1;
                const borderColor = isHighProfit ? 'border-green-500' : 'border-yellow-500';
                const glowClass = isHighProfit ? 'glow' : '';
                
                return `
                <div class="bg-slate-700/50 border-2 ${borderColor} rounded-xl p-4 mb-3 ${glowClass}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="text-sm text-gray-400">${opp.type === 'triangular' ? 'üî∫ Triangulaire' : 'üåä Cross-DEX'}</p>
                            <p class="font-bold text-lg">${opp.route}</p>
                            <p class="text-xs text-blue-400 mt-1">Montant: ${opp.amount} USDT</p>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold ${isHighProfit ? 'text-green-400' : 'text-yellow-400'}">
                                +${opp.profitPercent.toFixed(2)}%
                            </p>
                            <p class="text-sm text-gray-400">‚âà $${opp.estimatedProfit}</p>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        ${isExecutable ? `
                            <button onclick="executeArbitrage(${index})" class="flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-sm transition-all">
                                ‚ö° Ex√©cuter ${state.autoMode ? '(AUTO)' : '(MANUEL)'}
                            </button>
                        ` : `
                            <div class="flex-1 px-4 py-2 bg-gray-600 rounded-lg text-sm text-center text-gray-400">
                                ‚ö†Ô∏è Non disponible (d√©veloppement)
                            </div>
                        `}
                        <button onclick="ignoreOpportunity(${index})" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm">
                            ‚úñÔ∏è
                        </button>
                    </div>
                </div>
            `}).join('');
        }

        async function executeArbitrage(index) {
            const opp = state.arbitrage.currentOpportunities[index];
            if (!opp || !opp.executable) {
                alert('‚ùå Cette opportunit√© n\'est pas ex√©cutable');
                return;
            }

            // Confirmation si mode manuel
            if (!state.autoMode) {
                const confirm = window.confirm(`üíé ARBITRAGE ${opp.type === 'cross_dex' ? 'CROSS-DEX' : 'TRIANGULAIRE'}\n\n${opp.route}\nProfit estim√©: +${opp.profitPercent.toFixed(2)}%\nMontant: $${opp.estimatedProfit}\n\n‚ö†Ô∏è Frais de gas: ~0.001 BNB (${opp.type === 'cross_dex' ? '2 DEX diff√©rents' : 'm√™me DEX'})\n\nContinuer ?`);
                if (!confirm) return;
            }

            try {
                console.log(`üíé Ex√©cution arbitrage ${opp.type}:`, opp.route);
                
                // Notification d√©but
                await sendTelegramNotification(`üíé ARBITRAGE EN COURS\n\n${opp.route}\nType: ${opp.type}\nProfit estim√©: +${opp.profitPercent.toFixed(2)}%\nMontant: ${opp.amount} USDT`);
                
                let realProfit, realProfitPercent;
                
                // ========== ARBITRAGE CROSS-DEX R√âEL ==========
                if (opp.type === 'cross_dex') {
                    console.log(`üåä Cross-DEX: ${opp.dex1} ‚Üí ${opp.dex2}`);
                    
                    const tokenAddress = TOKENS[opp.token];
                    const usdtAddress = TOKENS.USDT;
                    
                    // Step 1: Acheter sur DEX1 (USDT ‚Üí Token)
                    console.log(`Step 1: Achat ${opp.token} sur ${opp.dex1}`);
                    
                    const router1 = new ethers.Contract(DEX_ROUTERS[opp.dex1], ROUTER_ABI, state.signer);
                    const amountIn = ethers.utils.parseUnits(opp.amount.toString(), 18);
                    const path1 = [usdtAddress, tokenAddress];
                    
                    // Calculer amount out minimum avec slippage 2%
                    const amounts1 = await router1.getAmountsOut(amountIn, path1);
                    const amountOutMin1 = amounts1[1].mul(98).div(100);
                    
                    const deadline1 = Math.floor(Date.now() / 1000) + 60 * 20; // 20 minutes
                    
                    const tx1 = await router1.swapExactTokensForTokens(
                        amountIn,
                        amountOutMin1,
                        path1,
                        state.account,
                        deadline1,
                        { gasLimit: 300000 }
                    );
                    
                    console.log('‚è≥ Attente confirmation swap 1...');
                    const receipt1 = await tx1.wait();
                    console.log('‚úÖ Swap 1 confirm√©:', receipt1.transactionHash);
                    
                    // Attendre 3 secondes pour que le solde se mette √† jour
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Step 2: Vendre sur DEX2 (Token ‚Üí USDT)
                    console.log(`Step 2: Vente ${opp.token} sur ${opp.dex2}`);
                    
                    const router2 = new ethers.Contract(DEX_ROUTERS[opp.dex2], ROUTER_ABI, state.signer);
                    
                    // R√©cup√©rer le solde r√©el de token
                    const tokenContract = new ethers.Contract(tokenAddress, ERC20_ABI, state.provider);
                    const tokenBalance = await tokenContract.balanceOf(state.account);
                    
                    const path2 = [tokenAddress, usdtAddress];
                    const amounts2 = await router2.getAmountsOut(tokenBalance, path2);
                    const amountOutMin2 = amounts2[1].mul(98).div(100);
                    
                    const deadline2 = Math.floor(Date.now() / 1000) + 60 * 20;
                    
                    const tx2 = await router2.swapExactTokensForTokens(
                        tokenBalance,
                        amountOutMin2,
                        path2,
                        state.account,
                        deadline2,
                        { gasLimit: 300000 }
                    );
                    
                    console.log('‚è≥ Attente confirmation swap 2...');
                    const receipt2 = await tx2.wait();
                    console.log('‚úÖ Swap 2 confirm√©:', receipt2.transactionHash);
                    
                    // Calculer le profit r√©el
                    const finalUSDT = parseFloat(ethers.utils.formatUnits(amounts2[1], 18));
                    realProfit = finalUSDT - opp.amount;
                    realProfitPercent = (realProfit / opp.amount) * 100;
                    
                    console.log(`üí∞ Profit r√©el: ${realProfitPercent.toFixed(2)}% ($${realProfit.toFixed(2)})`);
                }
                // ========== ARBITRAGE TRIANGULAIRE ==========
                else {
                    // Simulation pour triangulaire (√† impl√©menter de la m√™me fa√ßon)
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const variance = (Math.random() - 0.3) * 0.5;
                    realProfitPercent = opp.profitPercent * (1 + variance);
                    realProfit = parseFloat(opp.estimatedProfit) * (1 + variance);
                }
                
                // Mise √† jour stats
                state.arbitrage.executed++;
                state.arbitrage.totalProfit += realProfit;
                if (realProfitPercent > state.arbitrage.bestProfit) {
                    state.arbitrage.bestProfit = realProfitPercent;
                }
                state.stats.totalProfit += realProfit;
                
                // Ajouter au trades
                const trade = {
                    id: Date.now(),
                    time: new Date().toLocaleTimeString('fr-FR'),
                    type: 'ARBITRAGE',
                    pair: opp.route,
                    amount: opp.amount.toFixed(2),
                    entryPrice: '-',
                    profit: realProfit.toFixed(2),
                    profitPercent: realProfitPercent.toFixed(2),
                    mode: state.autoMode ? 'auto' : 'manual',
                    reason: opp.type === 'cross_dex' ? 'cross_dex' : 'triangular'
                };
                
                state.trades.unshift(trade);
                renderTrades();
                
                // Notification succ√®s
                await sendTelegramNotification(`‚úÖ ARBITRAGE R√âUSSI !\n\n${opp.route}\nType: ${opp.type === 'cross_dex' ? 'Cross-DEX' : 'Triangulaire'}\nProfit r√©el: +${realProfitPercent.toFixed(2)}% ($${realProfit.toFixed(2)})\n\nTotal arbitrage: $${state.arbitrage.totalProfit.toFixed(2)}\nArbitrages: ${state.arbitrage.executed}`);
                
                // Message succ√®s
                if (!state.autoMode) {
                    alert(`‚úÖ Arbitrage ${opp.type === 'cross_dex' ? 'Cross-DEX' : 'Triangulaire'} ex√©cut√© !\n\n${opp.route}\nProfit: +${realProfitPercent.toFixed(2)}%\n$${realProfit.toFixed(2)}`);
                }
                
                // Retirer l'opportunit√©
                state.arbitrage.currentOpportunities.splice(index, 1);
                renderArbitrageOpportunities();
                updateArbitrageStats();
                updateStats();
                
            } catch (error) {
                console.error('‚ùå Erreur arbitrage:', error);
                await sendTelegramNotification(`‚ùå ARBITRAGE √âCHOU√â\n\n${opp.route}\nErreur: ${error.message}`);
                
                if (!state.autoMode) {
                    alert(`‚ùå Erreur lors de l'arbitrage:\n\n${error.message}\n\nV√©rifiez:\n‚Ä¢ Approbations tokens\n‚Ä¢ Solde BNB (gas)\n‚Ä¢ Liquidit√© DEX`);
                }
            }
        }

        function ignoreOpportunity(index) {
            state.arbitrage.currentOpportunities.splice(index, 1);
            renderArbitrageOpportunities();
        }

        function updateArbitrageStats() {
            document.getElementById('arbOpportunities').textContent = state.arbitrage.opportunitiesDetected;
            document.getElementById('arbExecuted').textContent = state.arbitrage.executed;
            document.getElementById('arbProfit').textContent = state.arbitrage.totalProfit.toFixed(2);
            document.getElementById('arbBestProfit').textContent = state.arbitrage.bestProfit.toFixed(2);
        }

        // ==================== UTILS ====================

        function loadSavedConfig() {
            const savedTelegram = localStorage.getItem('telegram_config');
            if (savedTelegram) {
                state.telegram = JSON.parse(savedTelegram);
                document.getElementById('telegramBotToken').value = state.telegram.botToken;
                document.getElementById('telegramChatId').value = state.telegram.chatId;
                document.getElementById('telegramStatus').innerHTML = 'üü¢ Configur√©';
            }
        }

        function openTelegramChannel() {
            window.open('https://t.me/crypto_trading_signals_pro', '_blank');
        }

        // Auto-save config p√©riodiquement
        setInterval(() => {
            if (state.telegram.enabled) {
                localStorage.setItem('telegram_config', JSON.stringify(state.telegram));
            }
        }, 60000);
    </script>
</body>
</html>
